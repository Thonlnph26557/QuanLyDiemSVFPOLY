@page "/chuyennganh/themmoichuyennganhhep/{idChuyenNganh}"
@using QLDSVFPOLY.BUS.ViewModels.ChuyenNganh
@using QLDSVFPOLY.BUS.ViewModels.DaoTao
@using QLDSVFPOLY.Blazor.Repository.Interfaces
@using QLDSVFPOLY.Blazor.Components;

@inject IChuyenNganhRepo ChuyenNganhRepo

<h3>ChuyenNganhHepThemMoi</h3>

<style>
	#dd {
		border: 2px black;
		width: 400px;
		height: 300px;
		margin-left: 50px;
	}
</style>

@if (chuyenNganh == null)
{
	<LoadingIndicator></LoadingIndicator>
}
else
{
	<EditForm Model="chuyenNganh">
		<div class="w-25" style="float: left; margin-top:30px">
			<img id="dd" /><br />
			<input multiple="" type="file" _bl_2="" style="margin-top:20px;margin-left:50px">
		</div>
		<div class="w-50" style="float: right;margin-top:20px">
			<div class="row" style="margin-top:15px">
				<div class="col">
					<label>Mã Chuyên Ngành</label>
					<input type="text" class="form-control" @bind="chuyenNganh.Ma">
				</div>
				<div class="col"></div>
			</div>
			<div class="row" style="margin-top:15px">
				<div class="col">
					<label>Tên Ngành</label>
					<input type="text" class="form-control" @bind="chuyenNganh.TenChuyenNganh">
				</div>
				<div class="col"></div>
			</div>
			<div class="row" style="margin-top:15px">
				<div class="col">
					<label>Trạng Thái</label>
					<select class="form-control" @bind="chuyenNganh.TrangThai">
						<option value="1">Hoạt động</option>
						<option value="2">Tạm dừng hoạt động</option>
					</select>
				</div>
				<div class="col"></div>
			</div>
			<div class="row" style="margin-top:15px">
				<div class="col">
					<button type="button" class="btn btn-primary" style="float:left" @onclick="()=>Clear()">LÀM MỚI</button>
					<button type="button" class="btn btn-primary" style="float:right" @onclick="()=>ThemChuyenNganhHep(chuyenNganh)">THÊM</button>
				</div>
				<div class="col"></div>
			</div>
		</div>
	</EditForm>
}

@code {
	[Parameter]
	public string idChuyenNganh { set; get; }

	//Inject Repo cua ChuyenNganh
	[Inject] private IChuyenNganhRepo ChuyenNganhRepos { set; get; }

	//Khai bao ra listChuyenNganh
	private List<ChuyenNganhVM> listChuyenNganhs;

	private ChuyenNganhSearchVM searchVM = new ChuyenNganhSearchVM();

	private ChuyenNganhCreateVM chuyenNganh = new ChuyenNganhCreateVM();

	protected override async Task OnInitializedAsync()
	{
		await LoadData();
	}

	private async Task LoadData()
	{
		listChuyenNganhs = await ChuyenNganhRepos.GetAllActiveAsync(searchVM);
		listChuyenNganhs = listChuyenNganhs.Where(c => c.IdDaoTao == Guid.Parse("9d01fb1f-6d12-4b11-9962-871c333e659b")).ToList();
	}

	private async Task<bool> ThemChuyenNganhHep(ChuyenNganhCreateVM chuyenNganh)
	{
		var chuyenNganhLon = await ChuyenNganhRepos.GetByIdAsync(Guid.Parse(idChuyenNganh));
		chuyenNganh.IdDaoTao = chuyenNganhLon.IdDaoTao;
		chuyenNganh.DuongDanAnh = "default.png";
		chuyenNganh.IdChuyenNganh = Guid.Parse(idChuyenNganh);
		if (await ChuyenNganhRepos.CreateAsync(chuyenNganh))
		{
			await LoadData();
			await Clear();
			return true;
		}
		return false;
	}

	private async Task Clear()
	{
		chuyenNganh.Ma = "";
		chuyenNganh.TenChuyenNganh = "";
		chuyenNganh.TrangThai = 0;
	}
}
